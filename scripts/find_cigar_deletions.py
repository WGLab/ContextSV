import re


def find_deletions(cigar_string, ref_pos):
    """
    Given a cigar string and a reference position, returns a list of all deletions in reference coordinates.
    """
    query_pos = 0
    deletions = []
    
    # Parse CIGAR string
    for length, operation in parse_cigar(cigar_string):

        if operation == 'D':  # Deletion
            # deletions.append((ref_pos, ref_pos + length, length))

            # Print out the current operation and length
            print(operation, length, ref_pos, ref_pos + length)

        if operation in ['M', 'D', 'N', '=', 'X']:
            ref_pos += length
        if operation not in ['I', 'S', 'H', 'P']:  # Not Insertion, Soft Clip, Hard Clip, Padding
            query_pos += length
    
    return deletions

# Function to parse CIGAR string into (length, operation) tuples
def parse_cigar(cigar):
    import re
    cigar_tuples = re.findall(r'(\d+)([MIDNSHP=X])', cigar)
    return [(int(length), operation) for length, operation in cigar_tuples]

# Take user input (cigar string and reference position)
# cigar_string = input("Enter cigar string: ")
# ref_pos = int(input("Enter reference position: "))
# # Call function
# deletions = find_deletions(cigar_string, ref_pos)

# cigar_string = "9S13M1D27M1I389M1I171M1I178M1D3M1D79M1D25M7D248M1D310M1D10M2D7M1D147M12I25M1D24M1D148M1I51M1D8M2D127M3D47M2I4M1D22M1D119M1D390M4D177M1I9M1D34M1D74M1D84M1I1M1I62M2I160M1D56M1D20M3D403M2D12M1I77M1D12M2D72M1I135M1I18M4D14M4I36M1I36M1D177M1D61M4I347M2D36M1D42M1D82M1D4M1I41M1I198M1I160M1D83M1D32M1D78M1D340M1D106M5D180M2D120M1D23M2D47M1D232M2D1M1D198M1D107M1D98M1D282M3I8M2D216M1D41M2D5M1D8M1I205M1I18M2I244M1D74M1D5M1D310M3D45M2I79M1D204M1I29M1I33M1I164M1I97M1D295M2I42M3I69M1D473M2D22M1I59M4I36M1D20M2D...1I2M4I1M1I8M1D25M2I37M1I23M3I8M1D56M1I66M3D4M1D12M1D55M1D22M1D16M2I25M1I27M2I14M1D5M2D13M1I7M1I64M1I16M1D13M1D52M2I45M1D38M1I2M1I53M1D1M2D5M2D82M1D28M3I26M1I57M2I83M1D85M1D161M1I11M2I20M4I14M1D16M5I70M2D51M1D13M3D53M1D19M1I150M1D101M2I22M1D2M1D3M2D176M2I118M3D75M1D7M1I34M2I9M3I68M2I57M4I102M1I38M1I1M4D8M2D35M1D100M1D4M1D76M1D7M1D143M1I69M1D133M2D68M1D149M1D90M1D81M3D1M1D5M1D1M2D12M2I5M1I45M1D75M1D78M1D5M2D68M2I22M1I7M2D299M1I5M2I142M2D17M1D113M62D12M1D140M1D4M3D78M1D17M1D443M1D5M2D136M1I19M28S"
# ref_pos = 41191391  # 0-based leftmost coordinate of the reference sequence
# deletions = find_deletions(cigar_string, ref_pos)

# cigar_string= "6S150M1I11M2D127M1D25M2D11M1D29M1D30M2I100M2I7M2I54M1I15M1D12M5D30M1D8M2I57M1D29M1D61M1I88M1D42M1D8M1I52M1D7M5I148M2I31M1D33M3D15M1D324M2I42M3I4M1D26M5I30M1D18M1I55M1D88M1D41M3D1M2D12M1D37M1D7M1D31M1I26M1D31M4I111M3D5M2D4M4D37M1D3M1D16M2I47M1D2M3D160M2D7M1I70M1D142M3D30M4I76M1D25M1I25M1I15M4D115M1D56M1D26M1D21M1I69M2I6M1I29M1D63M2I1M3D182M3D30M1D14M1D16M2D3M2D30M1I22M3D2M2D46M2D81M1D6M2I114M2D10M1D66M3D2M2D142M2I112M1D143M1D39M2D3M1D78M1D21M1D54M1D29M2D84M1I13M4I51M4D76M66D148M1D39M1D6M1D4M1D53M1I40M3I32M1D204M1D45M2I15M1I190M1D71M2D12M2D53M1D55M1I54M31S"
# ref_pos=41186795
# deletions = find_deletions(cigar_string, ref_pos)

cigar_string="4S68M1D157M2D36M1I174M1D7M1D64M1D35M4I98M2D212M1D54M2I102M1I139M1D331M1D81M1I12M1I211M2D102M1D126M1I270M1D148M1D164M1I16M1D58M1D212M1D16M1I75M1I62M1I39M2D43M1D144M3I45M1I73M2I79M2I428M1D8M1I28M1D73M1I407M1D81M1D242M2I68M2D175M2I6M3I15M4D85M1D39M1D152M1I54M1D55M3D223M3I4M3D564M1I3M1I4M1D20M1D77M1D348M1D104M1D20M3D48M1D120M1I22M1D3M1I61M2D69M1I1930M1I135M3D41M2I4M5D91M1D179M1I122M3D339M2I66M1D123M1D99M1I42M1D182M1I23M1D139M1D107M1D219M1I65M1I22M1D107M1D36M1I21M1D152M1I26M1D33M1I107M1D5M1D13M1D56M...1I37M1I43M1D2M1D124M1I37M1D251M1D100M2I22M1D2M2D4M1D20M4D4M2I320M1I97M1D21M2I10M3I6M1I142M1I39M2I145M1D76M2I175M1D273M1D74M1D21M2D8M1D32M1D94M1I47M2I397M1D318M2D264M2D49M2I32M2D254M2I95M1I50M1D100M2D11M3I32M1I121M2D38M1I6M1D52M1I45M1D277M2I200M1D98M1I73M1I33M1I52M1I72M2I233M1D22M3D64M2I139M3D260M1D497M1D1M2D91M22I136M2D27M1D292M1I409M1I1M1I132M1I3M1D112M2I18M1D117M1D8M2D30M1I63M1D8M1D16M4I8M2I12M1D42M1D19M1D50M1I189M1D160M1I178M1I125M3I2M2D63M3D240M1I123M1I14M1I304M1I151M1D3M1D14M1D238M1D6M27S"
ref_pos=41149857
deletions = find_deletions(cigar_string, ref_pos)

# Print output
# print("Deletions:")
# for deletion in deletions:
#     print(deletion)

# print("Mismatches:")
# for mismatch in mismatches:
#     print(mismatch)